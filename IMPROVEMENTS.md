# æ”¹è¿›æ—¥å¿—

> æœ¬æ–‡æ¡£è®°å½• model-finetune-tool é¡¹ç›®çš„æ”¹è¿›å†…å®¹

## æ”¹è¿›æ—¥æœŸ
- 2026-02-02

## å·²å®Œæˆçš„æ”¹è¿›

### ðŸ”´ é«˜ä¼˜å…ˆçº§

#### 1. ä¿®å¤ Markdown è§£æžå™¨é‡å¤ä»£ç 
**æ–‡ä»¶:** `src/parser/__init__.py`
**é—®é¢˜:** `_clean_markdown` å‡½æ•°è¢«è°ƒç”¨äº†ä¸¤æ¬¡
**ä¿®å¤:**
- æå– `_clean_markdown()` å’Œ `_split_paragraphs()` æ–¹æ³•
- æ¶ˆé™¤ä»£ç é‡å¤ï¼Œæé«˜å¯ç»´æŠ¤æ€§

#### 2. æ·»åŠ è·¯å¾„éåŽ†é˜²æŠ¤
**æ–‡ä»¶:** `src/main.py`
**é—®é¢˜:** æ²¡æœ‰éªŒè¯ç”¨æˆ·è¾“å…¥çš„è·¯å¾„
**ä¿®å¤:**
- æ·»åŠ  `validate_path()` å‡½æ•°æ£€æŸ¥è·¯å¾„å®‰å…¨æ€§
- é˜²æ­¢ç›®å½•éåŽ†æ”»å‡»
- éªŒè¯è·¯å¾„æ˜¯å¦åœ¨å…è®¸çš„ç›®å½•å†…

#### 3. æ·»åŠ è¾“å…¥éªŒè¯
**æ–‡ä»¶:** `src/main.py`
**é—®é¢˜:**
- æ²¡æœ‰æ–‡ä»¶å¤§å°é™åˆ¶
- æ²¡æœ‰æ–‡æœ¬é•¿åº¦é™åˆ¶
- Magic Numbers ç¡¬ç¼–ç 

**ä¿®å¤:**
- æ·»åŠ  `validate_file_size()` é™åˆ¶æ–‡ä»¶å¤§å° (é»˜è®¤ 50MB)
- æ·»åŠ  `validate_text_length()` é™åˆ¶æ–‡æœ¬é•¿åº¦ (é»˜è®¤ 100KB)
- æå–å¸¸é‡ `MIN_CHUNK_LENGTH`, `MAX_TEXT_LENGTH`, `MAX_FILE_SIZE`

#### 4. å®Œå–„æ•°æ®åº“ç´¢å¼•
**æ–‡ä»¶:** `src/dataset/__init__.py`
**é—®é¢˜:** å¸¸ç”¨æŸ¥è¯¢å­—æ®µç¼ºå°‘ç´¢å¼•
**ä¿®å¤:**
- `documents` è¡¨æ·»åŠ :
  - `idx_document_file_type` - æ–‡ä»¶ç±»åž‹ç´¢å¼•
  - `idx_document_created_at` - åˆ›å»ºæ—¶é—´ç´¢å¼•
- `dataset_items` è¡¨æ·»åŠ :
  - `idx_item_dataset_created` - å¤åˆç´¢å¼• (dataset_name, created_at)
  - `idx_item_document_source` - å¤åˆç´¢å¼• (document_id, source_file)

### ðŸŸ¡ ä¸­ä¼˜å…ˆçº§

#### 5. æ·»åŠ æ—¥å¿—è®°å½•
**æ–‡ä»¶:** `src/dataset/__init__.py`, `src/main.py`
**é—®é¢˜:** ä½¿ç”¨ `print/click.echo` è¾“å‡ºï¼Œæ²¡æœ‰ç»Ÿä¸€æ—¥å¿—
**ä¿®å¤:**
- æ·»åŠ  `logging` æ¨¡å—æ”¯æŒ
- åœ¨ DatasetManager ä¸­è®°å½•å…³é”®æ“ä½œ:
  - æ·»åŠ æ–‡æ¡£/æ•°æ®é›†æ¡ç›®
  - å¯¼å‡º/æ¸…ç©ºæ•°æ®é›†
  - è­¦å‘Šå±é™©æ“ä½œ

#### 6. æ·»åŠ  .env.example æ¨¡æ¿
**æ–‡ä»¶:** `.env.example` (æ–°å»º)
**é—®é¢˜:** æ²¡æœ‰çŽ¯å¢ƒå˜é‡é…ç½®æ¨¡æ¿
**ä¿®å¤:**
- åˆ›å»º `.env.example` æ¨¡æ¿æ–‡ä»¶
- åŒ…å«æ‰€æœ‰å¯é€‰é…ç½®é¡¹çš„è¯´æ˜Ž

#### 7. ä¼˜åŒ–ä¾èµ–ç‰ˆæœ¬ç®¡ç†
**æ–‡ä»¶:** `requirements.txt`
**é—®é¢˜:** ä½¿ç”¨ `>=` å¯èƒ½å¯¼è‡´å…¼å®¹æ€§é—®é¢˜
**ä¿®å¤:**
- é”å®šç‰ˆæœ¬èŒƒå›´ï¼Œå¦‚ `pydantic>=2.0,<3.0`

#### 8. æ”¹è¿›å¼‚å¸¸å¤„ç†
**æ–‡ä»¶:** `src/llm/__init__.py`
**é—®é¢˜:** ä½¿ç”¨é€šç”¨ `Exception`ï¼Œç¼ºå°‘è‡ªå®šä¹‰å¼‚å¸¸
**ä¿®å¤:**
- æ·»åŠ è‡ªå®šä¹‰å¼‚å¸¸ç±»:
  - `LLMError` - é”™è¯¯åŸºç±»
  - `QAGenerationError` - QA ç”Ÿæˆé”™è¯¯
  - `JSONParseError` - JSON è§£æžé”™è¯¯
- åœ¨ `generate_qa_pairs()` ä¸­æ·»åŠ è¾“å…¥éªŒè¯

## æ–‡ä»¶å˜æ›´æ€»ç»“

| æ–‡ä»¶ | å˜æ›´ç±»åž‹ | è¯´æ˜Ž |
|------|----------|------|
| `src/parser/__init__.py` | é‡æž„ | æå–æ–¹æ³•ï¼Œæ¶ˆé™¤é‡å¤ä»£ç  |
| `src/main.py` | æ–°å¢ž + é‡æž„ | æ·»åŠ è·¯å¾„/è¾“å…¥éªŒè¯ï¼Œå¸¸é‡å®šä¹‰ |
| `src/dataset/__init__.py` | æ–°å¢ž + é‡æž„ | æ·»åŠ ç´¢å¼•ï¼Œæ—¥å¿—è®°å½• |
| `src/llm/__init__.py` | æ–°å¢ž + é‡æž„ | æ·»åŠ å¼‚å¸¸ç±»ï¼Œè¾“å…¥éªŒè¯ |
| `.env.example` | æ–°å¢ž | çŽ¯å¢ƒå˜é‡æ¨¡æ¿ |
| `requirements.txt` | ä¿®æ”¹ | é”å®šç‰ˆæœ¬èŒƒå›´ |

## æ€§èƒ½æ”¹è¿›é¢„æœŸ

| æ”¹è¿›é¡¹ | é¢„æœŸæ•ˆæžœ |
|--------|----------|
| æ•°æ®åº“ç´¢å¼• | æŸ¥è¯¢é€Ÿåº¦æå‡ 2-10x |
| è¾“å…¥éªŒè¯ | é¿å…æ— æ•ˆå¤„ç†ï¼ŒèŠ‚çœèµ„æº |
| æ—¥å¿—è®°å½• | ä¾¿äºŽé—®é¢˜æŽ’æŸ¥å’Œç›‘æŽ§ |

## å®‰å…¨æ”¹è¿›é¢„æœŸ

| æ”¹è¿›é¡¹ | æ•ˆæžœ |
|--------|------|
| è·¯å¾„éåŽ†é˜²æŠ¤ | é˜²æ­¢ç›®å½•éåŽ†æ”»å‡» |
| æ–‡ä»¶å¤§å°é™åˆ¶ | é˜²æ­¢èµ„æºè€—å°½ |
| æ–‡æœ¬é•¿åº¦é™åˆ¶ | é˜²æ­¢å†…å­˜æº¢å‡º |

## åŽç»­å»ºè®®

### ðŸŸ¢ ä½Žä¼˜å…ˆçº§æ”¹è¿›

1. **æ·»åŠ  Docker æ”¯æŒ**
   - åˆ›å»º `Dockerfile`
   - åˆ›å»º `docker-compose.yml`

2. **å®žçŽ°å¹¶è¡Œå¤„ç†**
   - ä½¿ç”¨ `concurrent.futures` å¹¶è¡Œè§£æžæ–‡æ¡£
   - æ·»åŠ  `--max-workers` å‚æ•°

3. **å®žçŽ° LLM æ‰¹å¤„ç†**
   - æ‰¹é‡è°ƒç”¨ LLM API
   - èŠ‚çœ API è°ƒç”¨æ¬¡æ•°

4. **æ·»åŠ  API æ–‡æ¡£**
   - ä½¿ç”¨ Sphinx ç”Ÿæˆ API æ–‡æ¡£
   - æ·»åŠ å…¬å…±æŽ¥å£è¯´æ˜Ž

5. **Windows å…¼å®¹æ€§æ”¹è¿›** âœ… å·²å®Œæˆ
   - æ·»åŠ å¹³å°æ£€æµ‹ (`IS_WINDOWS`)
   - è§„èŒƒåŒ–è·¯å¾„åˆ†éš”ç¬¦
   - ä¿®å¤ SQLite è·¯å¾„å¤„ç†
   - åˆ›å»º Windows å®‰è£…æŒ‡å—
   - æ›´æ–° `.gitignore` æ·»åŠ  Windows å¿½ç•¥é¡¹

6. **é…ç½®çƒ­é‡è½½å’ŒéªŒè¯** âœ… å·²å®Œæˆ
   - æ·»åŠ  `ConfigManager` ç±»æ”¯æŒçƒ­é‡è½½
   - æ·»åŠ é…ç½®éªŒè¯ï¼ˆtemperature, max_tokens, batch_size ç­‰ï¼‰
   - æ·»åŠ é…ç½®éªŒè¯å™¨ï¼ˆèŒƒå›´æ£€æŸ¥ã€ç±»åž‹æ£€æŸ¥ï¼‰
   - å¯¼å‡º `reload_config()` å‡½æ•°

7. **ä¿¡å·å¤„ç†å’Œå…¨å±€å‚æ•°** âœ… å·²å®Œæˆ
   - æ·»åŠ  `setup_signal_handlers()` å‡½æ•°
   - æ·»åŠ  `--verbose` å’Œ `--quiet` å…¨å±€é€‰é¡¹
   - æ·»åŠ  CLI å‚æ•°éªŒè¯ï¼ˆchunk-size, qa-pairs èŒƒå›´ï¼‰
   - ä½¿ç”¨ logger æ›¿ä»£ print

8. **ç¼“å­˜ç®¡ç†æ”¹è¿›** âœ… å·²å®Œæˆ
   - æ·»åŠ ç¼“å­˜æ¸…ç†æœºåˆ¶ï¼ˆå¤§å°é™åˆ¶ã€æ—¶é—´é™åˆ¶ï¼‰
   - æ·»åŠ  `CacheManager.get_stats()` æ–¹æ³•
   - æ·»åŠ  `CacheManager.clear()` æ–¹æ³•
   - æ·»åŠ è‡ªå®šä¹‰å¼‚å¸¸ç±»

9. **è®­ç»ƒæ¨¡å—æ”¹è¿›** âœ… å·²å®Œæˆ
   - æ·»åŠ  `check_gpu_available()` GPU æ£€æµ‹
   - æ·»åŠ  `get_device_map()` è®¾å¤‡é€‰æ‹©
   - æ·»åŠ è®­ç»ƒæ¢å¤æ”¯æŒ (`resume_from`)
   - ä½¿ç”¨ logger æ›¿ä»£ print

10. **CLI å…¥å£é…ç½®** âœ… å·²å®Œæˆ
    - åœ¨ `pyproject.toml` æ·»åŠ  `[project.scripts]`
    - æ”¯æŒ `finetune` å‘½ä»¤ç›´æŽ¥è¿è¡Œ

11. **å¼€å‘å·¥å…·** âœ… å·²å®Œæˆ
    - åˆ›å»º `Makefile` å¸¸ç”¨å‘½ä»¤å¿«æ·æ–¹å¼
    - åˆ›å»º `CHANGELOG.md` ç‰ˆæœ¬æ›´æ–°è®°å½•
    - åˆ›å»º `CONTRIBUTING.md` è´¡çŒ®æŒ‡å—
    - åˆ›å»º `.github/workflows/ci.yml` CI/CD é…ç½®
    - åˆ›å»º `.pre-commit-config.yaml` ä»£ç æ£€æŸ¥é’©å­

## æµ‹è¯•éªŒè¯

è¿è¡Œä»¥ä¸‹å‘½ä»¤éªŒè¯æ”¹è¿›:

```bash
# è¯­æ³•æ£€æŸ¥
python3 -m py_compile src/main.py src/config.py src/parser/__init__.py src/dataset/__init__.py src/llm/__init__.py

# å•å…ƒæµ‹è¯• (éœ€è¦å®‰è£…ä¾èµ–)
pip install pytest
pytest tests/ -v
```

---

**æ”¹è¿›å®Œæˆæ—¥æœŸ:** 2026-02-02
**æ”¹è¿›è´Ÿè´£äºº:** è”·è–‡ ðŸŒ¹
